<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introducci칩n a R para RRHH</title>
    <meta charset="utf-8" />
    <script src="Clase_1_files/header-attrs/header-attrs.js"></script>
    <link href="Clase_1_files/remark-css/default.css" rel="stylesheet" />
    <link href="Clase_1_files/remark-css/shinobi.css" rel="stylesheet" />
    <link href="Clase_1_files/remark-css/tamu-fonts.css" rel="stylesheet" />
    <link href="Clase_1_files/font-awesome/css/fontawesome-all.min.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">

class: inverse, top, center
background-image: url(Archivos/portada.png)
background-size: cover



---
class: inverse

## Antes de empezar

Si quieren compartir im치genes del curso en redes sociales lo pueden hacer, tanto si les gust칩 como si no les gust칩.

--

.pull-left[
Los hashtags que pueden usar son 
* ### #R4HR 
* ### #RStats_ES 
* ### #data4hr 
* ### #BetterWithData
* ### #PeopleAnalytics 
* ... y el hashtag que quieran


Tambi칠n pueden arrobar a Data 4HR y unirse a los grupos

`&lt;i class="fab  fa-facebook "&gt;&lt;/i&gt;`{=html} [Freakys de RRHH](https://www.facebook.com/groups/freakysderrhh)

`&lt;i class="fab  fa-slack "&gt;&lt;/i&gt;`{=html} [Slack R4HR](https://join.slack.com/t/r4hr/shared_invite/zt-geqfwra8-iZv3G5admNbyuej2gyFQDg)

]

.pull-right[
&lt;img src="https://media.giphy.com/media/l0IycI0rreFNQwmSQ/giphy.gif" /&gt;
]


---

## Antes de empezar

Algunas cosas que tienen que saber:

* El link de Zoom va a ser siempre el mismo. 游띯

--

* No hace falta que tengan la c치mara encendida. 游돗

--

* Las clases las grabo y las comparto de manera privada por Youtube. 游꿘

--

* Vamos a usar documentos compartidos para tomar notas. 游닀

--

* S칰mense al grupo de [Slack](https://join.slack.com/t/r4hr/shared_invite/zt-geqfwra8-iZv3G5admNbyuej2gyFQDg) ya que todas las consultas las hacemos por ah칤. 游뱊游뱉

--

* Pueden interrumpir las veces que quieran. 游뗾


---

# Clase 1 - Introducci칩n a R y Tidyverse
## R

R es un lenguaje de c칩digo abierto, creado principalmente para el an치lisis estad칤stico de datos.

Su popularidad se debe gracias a la enorme comunidad global que permanentemente actualiza paquetes, y genera contenido. Aparte de los desarrollos de machine learning que se hacen en todo el mundo, te pod칠s encontrar con:

--

* La [BBC](https://github.com/bbc/bbplot) y [The Economist](http://rstudio-pubs-static.s3.amazonaws.com/284329_c7e660636fec4a42a09eed968dc47f32.html) construyendo paquetes y *temas* para los gr치ficos.

--

* [Airbnb](https://peerj.com/preprints/3182.pdf) us치ndolo para sus investigaciones, modelos y reportes.

--

* Yo lo uso para los informes de nuestros proyectos...

--

.right[... y para hacer estas presentaciones 游녨]

---

## Ventajas de R

Aprender R para RRHH tiene inagotables ventajas:

* Hacer an치lisis predictivos (Clase 3 de este curso!)
* Reproducir el trabajo
* M치s capacidad de procesamiento que Excel
* Automatizar el trabajo
* Analizar **todo** tipo de datos
  * Tablas
  * Bases de Datos, Sistemas de Gesti칩n
  * Texto libre
  * Im치genes
* Enviar mails con reportes autom치ticos
* Escribir libros, blogs, CV
* La comunidad de R

---
## La comunidad de R

R cuenta con una red de soporte muy amplia, s칩lida y solidaria, especialmente en Latinoam칠rica. Pr치cticamente en todos los pa칤ses del continente hay RUG (R Users Group) para el p칰blico en general, y toda una red de R-Ladies que promueven la diversidad de mujeres y de minor칤as, para generar mejores oportunidades laborales.

&lt;img src="Archivos/rugs.png" /&gt;

Pueden explorar todos los RUG [https://benubah.github.io/r-community-explorer/rladies.html](https://benubah.github.io/r-community-explorer/rladies.html)

---
## El Club de R para RRHH
&lt;br&gt;&lt;br&gt;

.pull-left[
&lt;img src="Archivos/Catbert.png" /&gt;
]

En esta misma l칤nea, desde Mayo de 2020 empezamos a desarrollar una comunidad espec칤fica para el mundo de RRHH, donde nos reunimos el primer s치bado de cada mes los s치bados de 10:00 a 11:30 hs. (hora de Argentina) para aprender a programar en este lenguaje.

Revisamos paquetes, exploramos formas de hacer an치lisis predictivos, y el plan es poder desarrollar una red similar a los RUGs y R-Ladies.


&gt; **Todo el contenido generado por m칤 en el Club lo pueden usar para sus propios grupos y cursos**

---
## Aprender a programar

Al principio programar es un acto de fe. Vemos que pasan cosas, que escribo algo y una cosa aparece en la pantalla pero no sabemos por qu칠, c칩mo, y por qu칠 no me sale de nuevo.

En particular R, y sus paquetes, permiten expresar lo que quiero programar mayormente de una forma similar a la que lo har칤a si tuviera que dar las instrucciones verbalmente a alguien. Y a diferencia de otros lenguajes como html por ejemplo, la sintaxis del c칩digo (las instrucciones) es mucho m치s simple (entren a cualquier p치gina web y aprieten F12).

Tambi칠n les va a pasar con este curso que muchas cosas les va a resultar m치s sencillas de hacer en Excel. O que tal vez buscando en internet encontraste otra forma de hacer las cosas, y est치 bien que as칤 sea.

Lo 칰nico que van a necesitar para programar es:

* Paciencia
* Constancia
* Curiosidad

Y con el tiempo, y la pr치ctica, un d칤a ten칠s una epifan칤a y todo lo que volcas en un c칩digo cobra sentido.


---
class: inverse, center, middle
# Basta de ch치chara!
&lt;img src="https://img.redbull.com/images/c_crop,x_230,y_0,h_1030,w_824/c_fill,w_860,h_1075/q_auto,f_auto/redbullcom/2019/07/17/44f55f2f-a5f9-44d0-9c62-31672feca5a2/hay-tabla" width="40%"/&gt;


---
# El lenguaje R


En rigor a la verdad, R es un **lenguaje**, no un programa. Lo que escribimos en la consola de R (de ahora en adelante, el *script*) son las instrucciones para que la computadora ejecute lo que le pedimos.

--

Usamos *RStudio* porque nos facilita seguir el c칩digo, ver y copiar los resultados, gestionar los archivos de fuentes de datos, ver los gr치ficos, etc..

--

.center[
&lt;img src="Archivos/paneles-rstudio.png" width="48%" /&gt;
]
---
class: inverse, center, middle
# Personalizando RStudio

&lt;img src="https://e00-elmundo.uecdn.es/blogs/elmundo/asesinoenserie/imagenes_posts/2017/10/22/189006_540x360.jpg" /&gt;   
---


# El lenguaje R
## Proyectos

Trabajar con proyectos en RStudio hace que todo el trabajo sea m치s sencillo. Los proyectos crean una carpeta en nuestra PC en donde se almacenar치n los archivos, tablas, scripts, y hace que todo sea m치s organizado.

--

Para crear un proyecto ten칠s pod칠s entrar en:
* *File*
  * *New project*

Y luego poner el nombre de la carpeta.

.pull-left[&lt;img src="Archivos/new_project.png" width="60%" /&gt;]


.pull-rigt[&lt;img src="Archivos/new_projecto.png" width="30%" /&gt;]

---

# El lenguaje R
## Objetos

--

Por definici칩n, R es un lenguaje *orientado a objetos*. Esto significa que a una tabla, un valor, una variable, etc. le voy a poner un nombre, y esa cosa que ahora tiene nombre se llama **objeto**.

Esto nos simplifica un mont칩n la vida. La asignaci칩n la hacemos con el s칤mbolo `&lt;-` que simula una flecha hacia la izquierda. Tambi칠n se puede hacer con el s칤mbolo `=` pero como muchas veces lo utilizamos para configurar un par치metro de una funci칩n usamos *"la flechita"*. 


```r
# Esto es un comentario

objeto_1 &lt;- 1979
objeto_2 &lt;- 2020-1979

# Para ver el resultado del objeto uso las teclas Ctrl + Enter
# Tambi칠n puedo usar el 칤cono  "Run"
objeto_1
```

```
## [1] 1979
```

```r
objeto_2
```

```
## [1] 41
```

---
## Tipos de objetos

Tenemos varios tipos de objetos. Uno de los objetos m치s utilizados son los **vectores** que son conjuntos de valores, num칠ricos, de texto, o combinados.


```r
# Vector de Texto
nombres &lt;- c("John", "Mike", "Ringo", "George") 
nombres
```

```
## [1] "John"   "Mike"   "Ringo"  "George"
```

```r
# Las variables de texto van siempre con comillas.

# Cambiar un elemento del vector 
nombres[2] &lt;- "Paul"
nombres
```

```
## [1] "John"   "Paul"   "Ringo"  "George"
```

```r
# Vector num칠rico
anio_nacimiento &lt;- c(1940, 1942, 1940, 1943)
viven &lt;- c(0,1,1,0)
```


---

## Dataframes

Vamos a llamar **dataframe** a los *datasets*, a las tablas que contienen nuestros datos. Al igual que una planilla de c치lculo, tiene filas y columnas.

Podemos crear dataframes con los vectores que tengan la misma cantidad de objetos.


```r
instrumentos &lt;- c("guitar", "bass", "drums", "piano")

# Crear un dataframe con los vectores
*beatles &lt;- data.frame(nombres, instrumentos, anio_nacimiento, viven)

beatles
```

```
##   nombres instrumentos anio_nacimiento viven
## 1    John       guitar            1940     0
## 2    Paul         bass            1942     1
## 3   Ringo        drums            1940     1
## 4  George        piano            1943     0
```

---
## Dataframes

.pull-left[Para acceder a un elemento de un dataframe tenemos que usar la siguiente l칩gica:

`nombre_dataframe[fila, columna]`


```r
beatles[1,3]
```

```
## [1] 1940
```

--

Si queremos elegir toda una fila dejamos el espacio de la columna vac칤o

```r
beatles[3,]
```

```
##   nombres instrumentos anio_nacimiento viven
## 3   Ringo        drums            1940     1
```
]

--

.pull-right[
Lo mismo para seleccionar una columna

```r
beatles[,3]
```

```
## [1] 1940 1942 1940 1943
```

--

Y si quiero cambiar un elemento puntual puedo hacerlo de la siguiente manera

```r
beatles[4,2] &lt;- "guitar"
beatles
```

```
##   nombres instrumentos anio_nacimiento viven
## 1    John       guitar            1940     0
## 2    Paul         bass            1942     1
## 3   Ringo        drums            1940     1
## 4  George       guitar            1943     0
```

]

---

## Dataframes

Para seleccionar m치s de una columna podemos hacerlo de dos maneras:

1. Si son columnas contiguas usando `:`.


```r
beatles[,2:4]
```

```
##   instrumentos anio_nacimiento viven
## 1       guitar            1940     0
## 2         bass            1942     1
## 3        drums            1940     1
## 4       guitar            1943     0
```

--

Si las columnas no est치n contiguas.

```r
beatles[, c(2, 4)]
```

```
##   instrumentos viven
## 1       guitar     0
## 2         bass     1
## 3        drums     1
## 4       guitar     0
```

--

Tambi칠n podemos usar los nombres de las variables. No olviden las comillas!


```r
beatles[,c("nombres", "viven")]
```

```
##   nombres viven
## 1    John     0
## 2    Paul     1
## 3   Ringo     1
## 4  George     0
```



---
# El lenguaje R
## Paquetes

Los paquetes son *"programitas"* que ampl칤an las capacidades de R para hacer cosas espec칤ficas, simplificando la programaci칩n.

--

La mayor칤a de los paquetes son curados por [CRAN](https://cran.r-project.org/) y se instalan de manera muy simple con la funci칩n `install.packages()`.


```r
install.packages("openxlsx")
```

Las comillas son muy importantes

--

La instalaci칩n se hace una sola vez. Para usarlo, cada vez que abrimos el *script* tenemos que cargarlo con la funci칩n `library()`. A diferencia de la instalaci칩n, no hace falta las comillas. 


```r
library(openxlsx)
```

```
## Warning: package 'openxlsx' was built under R version 4.0.4
```

---
# El lenguaje R
## Carguemos nuestro primer archivo

Para cargar archivos en R, una buena pr치ctica es asignar el dataset, o conjunto de datos, a un objeto.

```r
nomina &lt;- read.xlsx("Nomina.xlsx")
```

--

Ahora, a explorarlo. Podemos ver las primeras filas con la funci칩n `head()`.


```r
head(nomina)
```

```
##     ID ANTIGUEDAD EDAD ESTADO_CIVIL HIJOS             AREA ID_CAT
## 1 1757          2   51            C     1 GERENCIA GENERAL     GM
## 2  180         38   63            C     1         TEMPLADO      5
## 3  242         37   64            C     2         TEMPLADO      5
## 4  260         36   61            C     2         TEMPLADO      5
## 5  277         36   64            S     4         LAMINADO      5
## 6  278         36   59            C     0         TEMPLADO      4
##                      N_CATEG
## 1            GERENTE GENERAL
## 2 OP. POLIV. AMPLIAM. ESPEC.
## 3 OP. POLIV. AMPLIAM. ESPEC.
## 4 OP. POLIV. AMPLIAM. ESPEC.
## 5 OP. POLIV. AMPLIAM. ESPEC.
## 6 OP. POLIV. ESPEC. COMPLETO
```

---
## Explorando el dataset

Ver la cantidad de filas y columnas:


```r
str(nomina)
```

```
## 'data.frame':	522 obs. of  8 variables:
##  $ ID          : num  1757 180 242 260 277 ...
##  $ ANTIGUEDAD  : num  2 38 37 36 36 36 35 35 35 40 ...
##  $ EDAD        : num  51 63 64 61 64 59 57 54 56 59 ...
##  $ ESTADO_CIVIL: chr  "C" "C" "C" "C" ...
##  $ HIJOS       : num  1 1 2 2 4 0 1 4 3 2 ...
##  $ AREA        : chr  "GERENCIA GENERAL" "TEMPLADO" "TEMPLADO" "TEMPLADO" ...
##  $ ID_CAT      : chr  "GM" "5" "5" "5" ...
##  $ N_CATEG     : chr  "GERENTE GENERAL" "OP. POLIV. AMPLIAM. ESPEC." "OP. POLIV. AMPLIAM. ESPEC." "OP. POLIV. AMPLIAM. ESPEC." ...
```

--

Los nombres de las variables.


```r
names(nomina)
```

```
## [1] "ID"           "ANTIGUEDAD"   "EDAD"         "ESTADO_CIVIL" "HIJOS"       
## [6] "AREA"         "ID_CAT"       "N_CATEG"
```


---

## Explorando el dataset

Otra funci칩n muy utilizada de R es `summary()`.


```r
summary(nomina)
```

```
##        ID           ANTIGUEDAD          EDAD       ESTADO_CIVIL      
##  Min.   : 180.0   Min.   : 0.000   Min.   :21.00   Length:522        
##  1st Qu.: 886.5   1st Qu.: 3.000   1st Qu.:29.00   Class :character  
##  Median :1664.0   Median : 7.000   Median :35.00   Mode  :character  
##  Mean   :1873.6   Mean   : 8.839   Mean   :37.35                     
##  3rd Qu.:3087.8   3rd Qu.:10.000   3rd Qu.:44.00                     
##  Max.   :3222.0   Max.   :40.000   Max.   :65.00                     
##      HIJOS           AREA              ID_CAT            N_CATEG         
##  Min.   :0.000   Length:522         Length:522         Length:522        
##  1st Qu.:0.000   Class :character   Class :character   Class :character  
##  Median :1.000   Mode  :character   Mode  :character   Mode  :character  
##  Mean   :1.588                                                           
##  3rd Qu.:2.000                                                           
##  Max.   :8.000
```

---

## Explorando el dataset

La funci칩n summary nos muestra, de las variables num칠ricas:

* El valor m칤nimo
* 1er. y 3er. cuartil
* Mediana
* Promedio (mean)
* El valor m치ximo

--

De las variables de tipo texto, como es de tipo `character` s칩lo nos indica la cantidad de observaciones. Si la cambiamos a tipo `factor` podemos obtener otra informaci칩n.


```r
# Cambiamos el tipo de variable de 'character' a 'factor'
nomina$ESTADO_CIVIL &lt;- as.factor(nomina$ESTADO_CIVIL)

summary(nomina$ESTADO_CIVIL)
```

```
##   C   K   S 
## 217  94 211
```

---

## Explorando los datos

Tambi칠n existen paquetes especiales, como `funModeling`y `tidyverse` que tienen funciones para explorar datos.

El paquete funModeling fue desarrollado por [Pablo Casas](https://www.linkedin.com/in/pcasas/) de la [Escuela de Datos Vivos](https://escueladedatosvivos.ai/courses).


```r
library(funModeling)

status(nomina)
```

```
##                  variable q_zeros    p_zeros q_na p_na q_inf p_inf      type
## ID                     ID       0 0.00000000    0    0     0     0   numeric
## ANTIGUEDAD     ANTIGUEDAD      40 0.07662835    0    0     0     0   numeric
## EDAD                 EDAD       0 0.00000000    0    0     0     0   numeric
## ESTADO_CIVIL ESTADO_CIVIL       0 0.00000000    0    0     0     0    factor
## HIJOS               HIJOS     145 0.27777778    0    0     0     0   numeric
## AREA                 AREA       0 0.00000000    0    0     0     0 character
## ID_CAT             ID_CAT       0 0.00000000    0    0     0     0 character
## N_CATEG           N_CATEG       0 0.00000000    0    0     0     0 character
##              unique
## ID              522
## ANTIGUEDAD       35
## EDAD             45
## ESTADO_CIVIL      3
## HIJOS             9
## AREA             17
## ID_CAT           19
## N_CATEG          23
```


---

# El paquete tidyverse

RStudio adem치s de desarrollar la IDE para usar R, es tambi칠n uno de los principales desarrolladores de paquetes.

Uno de sus paquetes, que engloba varios paquetes, se convirti칩 en un est치ndar de la limpieza y transformaci칩n de datos, que es **tidyverse**. A este est치ndar de limpieza de datos se lo llama *tidy data*, en donde entre sus principios dice:

&gt; Cada variable forma una columna.

&gt; Cada observaci칩n tiene que estar en una fila.

.right[&lt;img src="Archivos/hex_tidyverse.png" /&gt;]

---

# El paquete tidyverse

.center[&lt;img src="Archivos/tidyverse_packages.png" width="20%" /&gt;]

Tidyverse es un paquete que engloba varios paquetes, todos muy utilizados, a veces declarativamente, otras veces R lo usa detr치s de escenas. En esta sesi칩n vamos a usar principalmente los paquetes **dplyr** y **ggplot2**. Primero hay que instalar el paquete y luego cargarlo


```r
install.packages("tidyverse")
```

```r
library(tidyverse)
```

```
## -- Attaching packages --------------------------------------- tidyverse 1.3.0 --
```

```
## v tibble  3.1.0     v dplyr   1.0.4
## v tidyr   1.1.2     v stringr 1.4.0
## v readr   1.4.0     v forcats 0.5.1
## v purrr   0.3.4
```

```
## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter()    masks stats::filter()
## x dplyr::lag()       masks stats::lag()
## x dplyr::src()       masks Hmisc::src()
## x dplyr::summarize() masks Hmisc::summarize()
```


---

# El paquete tidyverse

Una de las razones por las cuales tidyverse se hizo tan popular es que la l칩gica de las funciones imita el razonamiento que har칤amos verbalmente.

--

Por ejemplo, 쯖칩mo har칤an para calcular la edad promedio por 치rea?

--


```r
nomina %&gt;% 
  select(AREA, EDAD) %&gt;% # Selecciona las columnas
  group_by(AREA) %&gt;%     # Agrupa por la variable AREA
  summarise(edad_promedio = mean(EDAD)) %&gt;% # Crea una variable con la edad promedio
  arrange(-edad_promedio) # Ordena descendentemente los resultados por la variable que pasemos.
```

```
## # A tibble: 17 x 2
##    AREA             edad_promedio
##    &lt;chr&gt;                    &lt;dbl&gt;
##  1 COMPRAS                   47.3
##  2 GERENCIA GENERAL          45.5
##  3 FACILITIES                45.2
##  4 ALMACEN                   41  
##  5 DESARROLLO                40.5
##  6 TEMPLADO                  39.5
##  7 LOGISTICA OE              38.6
##  8 LAMINADO                  37.7
##  9 INSERTOS                  36.0
## 10 ENCAPSULADO               35.8
## 11 CALIDAD                   35.6
## 12 RRHH                      35.4
## 13 LOGISTICA AGR             34.2
## 14 COMERCIAL OE              30  
## 15 MASS                      30  
## 16 COMERCIAL AGR             29.7
## 17 FINANZAS                  29.5
```

---

# El paquete tidyverse
## dplyr

쯌ieron este s칤mbolo `%&gt;%` en la slide anterior? En la jerga lo conocemos como *"pipe"* (atajo de teclado Ctrl + May칰s + M). Lo que nos permite este *"tubo"* es ordenar el c칩digo en secuencias, haci칠ndolo m치s comprensible a la lectura.

Una de las ventajas del *pipe* es que no necesitamos invocar al dataframe en cada funci칩n que encadenamos en el pipe.

.center[
&lt;img src="Archivos/dplyr_funciones.png" width="57%"/&gt;
]

---

## dplyr

Por ejemplo, queremos ver los empledos que tienen hijos por cada 치rea. Los pasos son:

1. Elegir las variables AREA, ID, HIJOS.
2. Filtrar de la variable HIJOS los casos en que s칤 tengan hijos.
3. Ordenar los resultados por 치rea.

&gt; Ac치 estoy usando la funci칩n `head()` para que quede prolijo en la presentaci칩n. Ustedes no la usen y recuerden sacar el 칰ltimo par칠ntesis


```r
head(arrange(filter(select(nomina, AREA,ID, HIJOS), HIJOS &gt; 0), AREA))
```

```
##      AREA   ID HIJOS
## 1 ALMACEN  653     2
## 2 ALMACEN  741     4
## 3 ALMACEN  980     2
## 4 ALMACEN 1436     1
## 5 ALMACEN 3117     2
## 6 CALIDAD  404     2
```

---

## dplyr

Esto mismo usando el pipe de dplyr lo hacemos as칤:

```r
nomina %&gt;%
  select(AREA, ID, HIJOS) %&gt;%
  filter(HIJOS&gt;0) %&gt;%
  arrange(AREA) %&gt;% 
  head()
```

```
##      AREA   ID HIJOS
## 1 ALMACEN  653     2
## 2 ALMACEN  741     4
## 3 ALMACEN  980     2
## 4 ALMACEN 1436     1
## 5 ALMACEN 3117     2
## 6 CALIDAD  404     2
```

---

class: inverse, middle
background-image: url("Archivos/dplyr.png")
background-size: cover



---
# Las funciones de dplyr

Habitualmente a las funciones del paquete dplyr las llamamos *verbos*. Para muchos paquetes desarrollados por RStudio existe un *cheat sheet* o gu칤a de referencia para ayudarnos a recordar las funciones m치s utilizadas y se encuentran en este link de [su p치gina](https://rstudio.com/resources/cheatsheets/).

En la secci칩n *Translations* podemos encontrar muchos cheat sheets en espa침ol. Ac치 pueden descargar el de [transformaci칩n de datos](https://github.com/rstudio/cheatsheets/raw/master/translations/spanish/data-transformation_Spanish.pdf) que veremos hoy.

---
# Las funciones de dplyr
## select()

La funci칩n select() sirve para elegir las columnas (variables) con las que queremos trabajar. Tambi칠n nos permite traer las columnas en el orden que las necesitemos.


```r
nomina %&gt;% 
* select(AREA, ID, HIJOS) %&gt;%
  head()
```

```
##               AREA   ID HIJOS
## 1 GERENCIA GENERAL 1757     1
## 2         TEMPLADO  180     1
## 3         TEMPLADO  242     2
## 4         TEMPLADO  260     2
## 5         LAMINADO  277     4
## 6         TEMPLADO  278     0
```

---

## select()

select() tiene algunas variantes interesantes (y en general aplican para casi todas las funciones de dplyr).

Supongamos que quiera seleccionar todas las columnas num칠ricas nada m치s:



```r
nomina %&gt;%
* select_if(is.numeric) %&gt;%
  head()
```

```
##     ID ANTIGUEDAD EDAD HIJOS
## 1 1757          2   51     1
## 2  180         38   63     1
## 3  242         37   64     2
## 4  260         36   61     2
## 5  277         36   64     4
## 6  278         36   59     0
```

---

## filter()

.pull-left[
`filter()` nos permite obtener las filas (observaciones) que cumplen con las condiciones que necesitamos.

Empleados que tienen hijos


```r
nomina %&gt;%
  select(ID, HIJOS) %&gt;% 
* filter(HIJOS &gt; 0) %&gt;%
  head()
```

```
##     ID HIJOS
## 1 1757     1
## 2  180     1
## 3  242     2
## 4  260     2
## 5  277     4
## 6  304     1
```

]

.pull-right[
Estas son los operadores l칩gicos que nos van a ayudar con la funci칩n filter.

&lt;img src="Archivos/operadores.png" /&gt;
]

---

## filter()

filter() nos permite obtener las filas (observaciones) que cumplen con las condiciones que necesitamos.

Empleados con antig칲edad menor al a침o, del sector INSERTOS.


```r
nomina %&gt;%
* filter(ANTIGUEDAD &lt; 1 &amp; AREA == "INSERTOS")
```

```
##     ID ANTIGUEDAD EDAD ESTADO_CIVIL HIJOS     AREA ID_CAT
## 1 1762          0   27            S     0 INSERTOS      C
## 2 3205          0   27            S     1 INSERTOS      1
## 3 3210          0   22            S     0 INSERTOS      1
## 4 3212          0   25            S     0 INSERTOS      1
## 5 3214          0   25            S     1 INSERTOS      1
## 6 3215          0   24            S     0 INSERTOS      1
## 7 3217          0   29            S     0 INSERTOS      1
## 8 3219          0   21            S     0 INSERTOS      1
##                   N_CATEG
## 1                 Cat : C
## 2 OP. POLIV. PRINCIPIANTE
## 3 OP. POLIV. PRINCIPIANTE
## 4 OP. POLIV. PRINCIPIANTE
## 5 OP. POLIV. PRINCIPIANTE
## 6 OP. POLIV. PRINCIPIANTE
## 7 OP. POLIV. PRINCIPIANTE
## 8 OP. POLIV. PRINCIPIANTE
```

---
## filter()

filter() nos permite obtener las filas (observaciones) que cumplen con las condiciones que necesitamos.

Empleados de dos 치reas diferentes

```r
nomina %&gt;%
* filter(AREA == "FINANZAS"| AREA == "RRHH")
```

```
##      ID ANTIGUEDAD EDAD ESTADO_CIVIL HIJOS     AREA ID_CAT N_CATEG
## 1  1642          7   34            C     2 FINANZAS      D Cat : D
## 2  1661          5   36            C     2 FINANZAS      J    JEFE
## 3  1667          5   32            C     0     RRHH      D Cat : D
## 4  1670          5   36            K     1     RRHH      D Cat : D
## 5  1689          4   28            C     1 FINANZAS      D Cat : D
## 6  1692          4   30            S     0 FINANZAS      D Cat : D
## 7  1699          4   46            S     1     RRHH      D Cat : D
## 8  1735          2   24            S     0 FINANZAS      D Cat : D
## 9  1741          1   25            S     0 FINANZAS      B Cat : B
## 10 1765          0   27            S     0     RRHH      D Cat : D
## 11 1687          5   36            S     0     RRHH     MG GERENTE
```
 
--

Una alternativa es usar un vector de selecci칩n

```r
nomina %&gt;%
* filter(AREA %in% c("FINANZAS", "RRHH"))
```

---

## arrange()

`arrange()` ordena las variables de acuerdo al criterio que queramos. Por default, ordena los datos ascendentemente.

.pull-left[
Ordenar los empleados por edad


```r
nomina %&gt;% select(ID, EDAD, AREA) %&gt;%
* arrange(EDAD) %&gt;%
  head()
```

```
##     ID EDAD          AREA
## 1 3219   21      INSERTOS
## 2 3221   21 LOGISTICA AGR
## 3 3185   22      INSERTOS
## 4 3210   22      INSERTOS
## 5 3211   22      LAMINADO
## 6 1756   23      TEMPLADO
```

]

--

.pull-right[
La funci칩n `arrange()` tambi칠n se puede usar con variables de texto.


```r
nomina %&gt;% select(ID, AREA, N_CATEG) %&gt;%
* arrange(AREA) %&gt;%
  head()
```

```
##     ID    AREA                    N_CATEG
## 1  653 ALMACEN OP. POLIV. AMPLIAM. ESPEC.
## 2  741 ALMACEN OP. POLIV. ESPEC. COMPLETO
## 3  882 ALMACEN OP. POLIV. ESPEC. COMPLETO
## 4  980 ALMACEN                    Cat : F
## 5 1436 ALMACEN            LIDER DE EQUIPO
## 6 1712 ALMACEN                    Cat : D
```

]

---
## arrange()

Para ordenar los datos ascendentemente hay dos alternativas.

.pull-left[
Con la funci칩n `desc()`.


```r
nomina %&gt;%
  select(ID, EDAD) %&gt;%
* arrange(desc(EDAD)) %&gt;%
  head()
```

```
##     ID EDAD
## 1  590   65
## 2 1475   65
## 3  242   64
## 4  277   64
## 5  180   63
## 6  722   63
```

]

--

.pull-right[
Con el signo menos `-`.

```r
nomina %&gt;%
  select(ID, ANTIGUEDAD) %&gt;%
* arrange(-ANTIGUEDAD)  %&gt;%
  head()
```

```
##     ID ANTIGUEDAD
## 1  345         40
## 2 1085         40
## 3 1368         40
## 4 1091         39
## 5  180         38
## 6  242         37
```

]

---

## group_by()

`group_by()` es una funci칩n para agrupar las variables en funci칩n de los valores de una de las columnas. Por ejemplo si quiero ver la antig칲edad por 치rea.


```r
nomina %&gt;%
  select(AREA, ANTIGUEDAD) %&gt;%
* group_by(AREA) %&gt;%
  head()
```

```
## # A tibble: 6 x 2
## # Groups:   AREA [3]
##   AREA             ANTIGUEDAD
##   &lt;chr&gt;                 &lt;dbl&gt;
## 1 GERENCIA GENERAL          2
## 2 TEMPLADO                 38
## 3 TEMPLADO                 37
## 4 TEMPLADO                 36
## 5 LAMINADO                 36
## 6 TEMPLADO                 36
```

---

## summarise()

`summarise()` se usa para crear nuevas columnas con medidas de resumen estad칤stico. Se suele usar mucho en conjunto con group_by().

Por ejemplo si quiero calcular la antig칲edad promedio por 치rea:


```r
nomina %&gt;%
  select(AREA, ANTIGUEDAD) %&gt;%
  group_by(AREA) %&gt;%
* summarise(Ant_Promedio = mean(ANTIGUEDAD)) %&gt;%
  head()
```

```
## # A tibble: 6 x 2
##   AREA          Ant_Promedio
##   &lt;chr&gt;                &lt;dbl&gt;
## 1 ALMACEN              10.2 
## 2 CALIDAD               6.54
## 3 COMERCIAL AGR         3.09
## 4 COMERCIAL OE          4   
## 5 COMPRAS              22   
## 6 DESARROLLO           10.5
```

---

## mutate()

`mutate()` se usa para crear una nueva columna, a partir de las columnas que ya existen.

Hagamos un c치lculo loco, creemos una columna nueva que calcule la diferencia entre la edad y la edad promedio de la empresa


```r
nomina %&gt;%
  select(ID, EDAD) %&gt;%
* mutate(Diferencia_Edad = EDAD - mean(EDAD)) %&gt;%
  head()
```

```
##     ID EDAD Diferencia_Edad
## 1 1757   51        13.65134
## 2  180   63        25.65134
## 3  242   64        26.65134
## 4  260   61        23.65134
## 5  277   64        26.65134
## 6  278   59        21.65134
```

---

## rename()

Muchas veces los nombres de las tablas vienen con nombres poco comprensibles si no est치s familiarizado, `rename()` te permite cambiar el nombre de una variable.

Su sintaxis es:

--

1. Nombre nuevo de la variable

--

2. Nombre original de la variable


```r
nomina &lt;- nomina %&gt;%
* rename(CATEGORIA = N_CATEG)

names(nomina)
```

```
## [1] "ID"           "ANTIGUEDAD"   "EDAD"         "ESTADO_CIVIL" "HIJOS"       
## [6] "AREA"         "ID_CAT"       "CATEGORIA"
```

---
class: inverse, middle

# Secuencia de an치lisis

## 1. Agrupar los grupos que quiero comparar (group_by)
## 2. Calcular medidas de resumen estad칤stico (summarise, mutate)
## 3. Graficar los resultados (ggplot)

---

# Unir datos de diferentes tablas

.pull-left[
La funci칩n `join() nos permite unir distintas tablas que contengan alguna columna en com칰n.
]

.pull-right[
&lt;img src="Archivos/donas.png" /&gt;
]

---

# Unir datos de diferentes tablas
# left_join()

La funci칩n `left_join()` une al dataframe de la izquierda, las coincidencias que obtengamos del dataframe de la derecha.

--

Primero, creemos un nuevo dataframe con los datos que est치n en la segunda pesta침a del archivo Nomina.xlsx usando el par치metro `sheet`.


```r
puestos &lt;- read.xlsx("Nomina.xlsx", sheet = "Puestos")

# Usemos una funci칩n de tidyverse para explorar el dataframe
glimpse(puestos)
```

```
## Rows: 135
## Columns: 3
## $ ID     &lt;dbl&gt; 597, 789, 791, 804, 816, 820, 851, 864, 867, 872, 892, 898, 918~
## $ PUESTO &lt;chr&gt; "TEC. MANTENIMIENTO", "VOLANTE", "JEFE", "LIDER DE EQUIPO", "LI~
## $ SUELDO &lt;dbl&gt; 25129, 24474, 44344, 34235, 26401, 26682, 23851, 25811, 25877, ~
```


---

## left_join

Ahora que tenemos dos dataframes, podemos unir la informaci칩n que necesitamos.

En de la funci칩n `left_join()` **dentro del pipe** primero tenemos que poner el nombre del dataframe que vamos a buscar los datos que necesitamos, y que coinciden con el primer dataset (`nomina`), y luego uso el par치metro `by` para indicar la variable que vamos a usar para unir los datos.

Esta es una funci칩n an치loga al *buscarv* de Excel. Para ampliar los conocimientos sobre los *joins* les recomiendo esta presentaci칩n de [Patricia Loto](https://patricialoto-relationaldatawithdplyr.netlify.app/#20).


```r
# Primero el nombre del dataframe, luego la variable de uni칩n.
nomina_full &lt;- nomina %&gt;% 
* left_join(puestos, by = "ID")

glimpse(nomina_full)
```

```
## Rows: 522
## Columns: 10
## $ ID           &lt;dbl&gt; 1757, 180, 242, 260, 277, 278, 304, 314, 315, 345, 362, 3~
## $ ANTIGUEDAD   &lt;dbl&gt; 2, 38, 37, 36, 36, 36, 35, 35, 35, 40, 33, 32, 32, 32, 32~
## $ EDAD         &lt;dbl&gt; 51, 63, 64, 61, 64, 59, 57, 54, 56, 59, 59, 55, 62, 52, 5~
## $ ESTADO_CIVIL &lt;fct&gt; C, C, C, C, S, C, K, C, K, C, S, S, S, C, C, C, C, C, C, ~
## $ HIJOS        &lt;dbl&gt; 1, 1, 2, 2, 4, 0, 1, 4, 3, 2, 1, 5, 0, 4, 2, 3, 2, 2, 0, ~
## $ AREA         &lt;chr&gt; "GERENCIA GENERAL", "TEMPLADO", "TEMPLADO", "TEMPLADO", "~
## $ ID_CAT       &lt;chr&gt; "GM", "5", "5", "5", "5", "4", "4", "4", "4", "5", "4", "~
## $ CATEGORIA    &lt;chr&gt; "GERENTE GENERAL", "OP. POLIV. AMPLIAM. ESPEC.", "OP. POL~
## $ PUESTO       &lt;chr&gt; "GERENTE GENERAL", NA, NA, NA, NA, NA, NA, NA, NA, NA, NA~
## $ SUELDO       &lt;dbl&gt; 94128, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA~
```


---
# Nuestro primer an치lisis

El dataset nuevo tiene los sueldos de algunos empleados, los mensualizados. Por eso tenemos en las nuevas variables `PUESTO` y `SUELDO` unos registros con datos nulos, y que figuran como `NA`.

As칤 que para nuestro primer an치lisis podemos crear un objeto nuevo, que lo llamaremos `mensuales` filtrando los datos nulos.


```r
# Filtramos todas las filas con NA en el campo PUESTO
mensuales &lt;- nomina_full %&gt;% 
* filter(!is.na(PUESTO))

glimpse(mensuales)
```

```
## Rows: 135
## Columns: 10
## $ ID           &lt;dbl&gt; 1757, 597, 789, 791, 804, 816, 820, 851, 864, 867, 872, 8~
## $ ANTIGUEDAD   &lt;dbl&gt; 2, 23, 12, 12, 11, 10, 10, 9, 9, 9, 9, 8, 8, 8, 7, 7, 7, ~
## $ EDAD         &lt;dbl&gt; 51, 55, 48, 34, 33, 40, 37, 41, 33, 28, 43, 41, 30, 30, 4~
## $ ESTADO_CIVIL &lt;fct&gt; C, C, C, C, C, C, K, C, C, S, K, C, C, C, C, K, C, K, S, ~
## $ HIJOS        &lt;dbl&gt; 1, 5, 2, 0, 3, 3, 2, 1, 2, 0, 1, 1, 1, 2, 3, 2, 4, 2, 0, ~
## $ AREA         &lt;chr&gt; "GERENCIA GENERAL", "LAMINADO", "CALIDAD", "TEMPLADO", "L~
## $ ID_CAT       &lt;chr&gt; "GM", "G", "F", "F", "F", "F", "E", "F", "F", "G", "F", "~
## $ CATEGORIA    &lt;chr&gt; "GERENTE GENERAL", "Cat : G", "Cat : F", "LIDER DE EQUIPO~
## $ PUESTO       &lt;chr&gt; "GERENTE GENERAL", "TEC. MANTENIMIENTO", "VOLANTE", "JEFE~
## $ SUELDO       &lt;dbl&gt; 94128, 25129, 24474, 44344, 34235, 26401, 26682, 23851, 2~
```

---
# Nuestro primer an치lisis

Ahora que tenemos un dataset m치s limpio podemos hacer nuestro primer an치lisis. Por ejemplo, calcular el sueldo promedio por puesto.


```r
sueldos_promedios &lt;- mensuales %&gt;% 
  select(PUESTO, SUELDO) %&gt;% 
* group_by(PUESTO) %&gt;%
* summarise(sueldo_promedio = mean(SUELDO))

sueldos_promedios
```

```
## # A tibble: 10 x 2
##    PUESTO             sueldo_promedio
##  * &lt;chr&gt;                        &lt;dbl&gt;
##  1 ANALISTA                    22971.
##  2 ENCARGADO                   26738 
##  3 GERENTE                     75098.
##  4 GERENTE GENERAL             94128 
##  5 INGENIERO                   31240.
##  6 JEFE                        44547 
##  7 LIDER DE EQUIPO             31434.
##  8 TEC. DESARROLLO             26755.
##  9 TEC. MANTENIMIENTO          28940.
## 10 VOLANTE                     24422.
```

---

# Nuestro primer an치lisis

.pull-left[
Y ahora podemos graficar los resultados usando el paquete `ggplot2` que ya est치 cargado dentro de `tidyverse`.

La sintaxis es:

1. La funci칩n ggplot
2. El dataframe a graficar
3. Las variables a graficar
4. El tipo de gr치fico


```r
ggplot(sueldos_promedios, aes(x = PUESTO, y = sueldo_promedio)) +
  geom_col()
```

]

.pull-right[

![](Clase_1_files/figure-html/unnamed-chunk-43-1.png)&lt;!-- --&gt;

]

---
# Nuestro primer an치lisis
## Mejoremos el gr치fico

.pull-left[

```r
ggplot(sueldos_promedios, 
       aes(x = reorder(PUESTO, sueldo_promedio), # Ordena el gr치fico por sueldos_promedios 
           y = sueldo_promedio)) + 
  geom_col() +
  coord_flip() + # Rota  el gr치fico
  labs(title = "Sueldos Promedios por Puesto", 
       subtitle = "A침o 2016",
       x = "Puesto",
       y = "Sueldo Promedio",
       caption = "Datos: Curso Introducci칩n a R para RRHH") +
  theme_minimal()
```

]

.pull-right[

![](Clase_1_files/figure-html/unnamed-chunk-44-1.png)&lt;!-- --&gt;

]

---

# Ejercicios

.pull-left[
1. Calcular el desv칤o est치ndar de los sueldos por 치rea con las funciones `summarise()` y `sd()`.
2. 쮺u치ntos empleados no tienen hijos?
3. Del archivo "HRDataset_v13.csv", 쯖u치les son las fuentes de reclutamiento (`RecruitmentSource`) de donde se hayan los empleados con mejor score de performance `PerfScoreID`?

]

.pull-right[
&lt;img src="https://i.pinimg.com/originals/33/58/18/335818b563208954ab8fc8896d2d3a18.png" width="90%" /&gt;
]



---
class: inverse, center, bottom

Presentaci칩n realizada con el paquete [Xaringan](https://github.com/yihui/xaringan) desarrollado por Yihui Xie.

Gracias a [Patricia Loto](https://twitter.com/patriloto) por compartir el [tutorial](https://twitter.com/patriloto/status/1260822644590608391?s=20)

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLines": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
